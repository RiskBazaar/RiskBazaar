var MongoClient = require('./').MongoClient

MongoClient.connect('mongodb://localhost:31000,localhost:31001,localhost:31002/test?rs_name=rs&maxPoolSize=100', {
  replSet: {
    socketOptions: {
      connectTimeoutMS: 2000,
      socketTimeoutMS: 2000,
    },
    // haInterval: 1500    
  }
}, function(err, db) {
  console.dir(err)

  db.serverConfig.on('timeout', function() {
    console.log("----- timeout")
  })

  db.serverConfig.on('close', function() {
    console.log("----- close")
  })
// MongoClient.connect('mongodb://localhost:31000/test?maxPoolSize=100', function(err, db) {
  // console.dir(err)
  //
  // db.on('reconnect', function() {
  //   console.log('reconnect', new Error().stack)
  // });
  //
  // setInterval(function() {
  //   db.collection('t').insertOne({a:1}, function(e) {
  //     // console.log("------ insert")
  //     // console.dir(e)
  //   });
  // }, 1)
  //
  // var doit = true;
  //
  // setInterval(function() {
  //   if(!doit) return
  //   console.log("-------------------------------------")
  //   // // force a reconnect
  //   // var replset = db.serverConfig.s.replset;
  //   // var state = replset.s.replState;
  //   // var connections = state.primary.connections();
  //   var connections = db.serverConfig.connections();
  //
  //   for(var i = 0; i < connections.length; i++) {
  //     connections[i].connection.write("da12123123213213123233123213123123123123asdacsdcdv ")
  //   }
  // }, 5000);

  // setInterval(function() {
  //   doit = false;
  //
  //   // db.close();
  // }, 10000);

  // db.close();
})
